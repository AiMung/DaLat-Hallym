{% extends "admin/base.html" %}
{% block title %}T·ªïng quan{% endblock %}

<!-- ‚≠ê T√™n trang ng·∫Øn g·ªçn cho breadcrumb trong topbar -->
{% block page_name %}T·ªïng quan{% endblock %}

<!-- ‚≠ê N·ªôi dung ch√≠nh b·∫Øt ƒë·∫ßu t·ª´ ƒë√¢y -->
{% block content %}

<!-- ============================================
     PAGE HEADER (Ph·∫ßn ƒë·∫ßu trang)
     ============================================ -->
<div class="page-header">
  <div>
    <h1>üéØ Dashboard - T·ªïng quan h·ªá th·ªëng</h1>
    <p class="subtitle">Gi√°m s√°t v√† v·∫≠n h√†nh ph√¢n lo·∫°i r√°c th·∫£i th·ªùi gian th·ª±c</p>
  </div>
  <div class="header-actions">
    <button class="btn-export" onclick="exportReport()">
      <i class="fas fa-download"></i> Xu·∫•t b√°o c√°o
    </button>
    <div class="date-range-picker">
      <i class="fas fa-calendar-alt"></i>
      <span id="dateRangeText">7 ng√†y qua</span>
    </div>
  </div>
</div>

<!-- ============================================
     KPI CARDS - 8 CARDS CH√çNH
     ============================================ -->
<div class="stats-grid-extended">
  <!-- Row 1: Main Metrics -->
  <div class="stat-card animate-slide-up">
    <div class="stat-header">
      <div class="stat-icon" style="background: linear-gradient(135deg, #5865F2, #7289DA);">
        <i class="fas fa-users"></i>
      </div>
      <div class="stat-badge">
        <span class="badge-success">
          <i class="fas fa-arrow-up"></i> +12.3%
        </span>
      </div>
    </div>
    <div class="stat-body">
      <h3 class="stat-number" data-target="1847">0</h3>
      <p class="stat-label">Ng∆∞·ªùi d√πng ho·∫°t ƒë·ªông</p>
      <div class="stat-mini-grid">
        <div class="mini-metric">
          <span class="mini-icon">üì±</span>
          <div>
            <strong>1,245</strong>
            <span>Mobile</span>
          </div>
        </div>
        <div class="mini-metric">
          <span class="mini-icon">üíª</span>
          <div>
            <strong>602</strong>
            <span>Desktop</span>
          </div>
        </div>
      </div>
      <div class="stat-footer">
        <span class="stat-detail">
          <i class="fas fa-user-plus"></i> 156 m·ªõi tu·∫ßn n√†y
        </span>
        <span class="stat-detail-right">
          <i class="fas fa-clock"></i> 23 ph√∫t avg.
        </span>
      </div>
    </div>
  </div>

  <div class="stat-card animate-slide-up delay-1">
    <div class="stat-header">
      <div class="stat-icon" style="background: linear-gradient(135deg, #10B981, #34D399);">
        <i class="fas fa-recycle"></i>
      </div>
      <div class="stat-badge">
        <span class="badge-success">
          <i class="fas fa-arrow-up"></i> +8.5%
        </span>
      </div>
    </div>
    <div class="stat-body">
      <h3 class="stat-number" data-target="3542">0</h3>
      <p class="stat-label">T·ªïng kg ƒë√£ ph√¢n lo·∫°i</p>
      <div class="stat-mini-grid">
        <div class="mini-metric">
          <span class="mini-icon">‚ôªÔ∏è</span>
          <div>
            <strong>1,487 kg</strong>
            <span>T√°i ch·∫ø</span>
          </div>
        </div>
        <div class="mini-metric">
          <span class="mini-icon">üåø</span>
          <div>
            <strong>1,240 kg</strong>
            <span>H·ªØu c∆°</span>
          </div>
        </div>
      </div>
      <div class="stat-footer">
        <span class="stat-detail">
          <i class="fas fa-leaf"></i> 478 kg tu·∫ßn n√†y
        </span>
        <span class="stat-detail-right">
          <i class="fas fa-trophy"></i> Top 5%
        </span>
      </div>
    </div>
  </div>

  <div class="stat-card animate-slide-up delay-2">
    <div class="stat-header">
      <div class="stat-icon" style="background: linear-gradient(135deg, #F59E0B, #FCD34D);">
        <i class="fas fa-coins"></i>
      </div>
      <div class="stat-badge">
        <span class="badge-success">
          <i class="fas fa-arrow-up"></i> +15.2%
        </span>
      </div>
    </div>
    <div class="stat-body">
      <h3 class="stat-number" data-target="89456">0</h3>
      <p class="stat-label">ƒêi·ªÉm ƒë√£ t√≠ch l≈©y</p>
      <div class="stat-mini-grid">
        <div class="mini-metric">
          <span class="mini-icon">üí∞</span>
          <div>
            <strong>67,234</strong>
            <span>C√≤n l·∫°i</span>
          </div>
        </div>
        <div class="mini-metric">
          <span class="mini-icon">üéÅ</span>
          <div>
            <strong>22,222</strong>
            <span>ƒê√£ ƒë·ªïi</span>
          </div>
        </div>
      </div>
      <div class="stat-footer">
        <span class="stat-detail">
          <i class="fas fa-gift"></i> 2,340 qu√† ƒë√£ ƒë·ªïi
        </span>
        <span class="stat-detail-right">
          <i class="fas fa-chart-line"></i> +284 today
        </span>
      </div>
    </div>
  </div>

  <div class="stat-card animate-slide-up delay-3">
    <div class="stat-header">
      <div class="stat-icon" style="background: linear-gradient(135deg, #8B5CF6, #A78BFA);">
        <i class="fas fa-camera"></i>
      </div>
      <div class="stat-badge">
        <span class="badge-success">
          <i class="fas fa-arrow-up"></i> +24.7%
        </span>
      </div>
    </div>
    <div class="stat-body">
      <h3 class="stat-number" data-target="12845">0</h3>
      <p class="stat-label">L∆∞·ª£t qu√©t AI h√¥m nay</p>
      <div class="stat-mini-grid">
        <div class="mini-metric">
          <span class="mini-icon">‚úÖ</span>
          <div>
            <strong>12,108</strong>
            <span>Th√†nh c√¥ng</span>
          </div>
        </div>
        <div class="mini-metric">
          <span class="mini-icon">‚ö†Ô∏è</span>
          <div>
            <strong>737</strong>
            <span>C·∫ßn review</span>
          </div>
        </div>
      </div>
      <div class="stat-footer">
        <span class="stat-detail">
          <i class="fas fa-bolt"></i> 94.2% ch√≠nh x√°c
        </span>
        <span class="stat-detail-right">
          <i class="fas fa-gauge-high"></i> 156ms avg.
        </span>
      </div>
    </div>
  </div>

  <!-- Row 2: Additional Metrics -->
  <div class="stat-card animate-slide-up delay-4">
    <div class="stat-header">
      <div class="stat-icon" style="background: linear-gradient(135deg, #EF4444, #F87171);">
        <i class="fas fa-fire"></i>
      </div>
      <div class="stat-badge">
        <span class="badge-warning">
          <i class="fas fa-minus"></i> -5.2%
        </span>
      </div>
    </div>
    <div class="stat-body">
      <h3 class="stat-number" data-target="247">0</h3>
      <p class="stat-label">R√°c nguy h·∫°i (kg)</p>
      <div class="stat-mini-grid">
        <div class="mini-metric">
          <span class="mini-icon">üîã</span>
          <div>
            <strong>128 kg</strong>
            <span>Pin & ƒëi·ªán t·ª≠</span>
          </div>
        </div>
        <div class="mini-metric">
          <span class="mini-icon">üíä</span>
          <div>
            <strong>119 kg</strong>
            <span>H√≥a ch·∫•t</span>
          </div>
        </div>
      </div>
      <div class="stat-footer">
        <span class="stat-detail">
          <i class="fas fa-truck"></i> 5 l·∫ßn thu gom
        </span>
        <span class="stat-detail-right critical">
          <i class="fas fa-exclamation-triangle"></i> C·∫ßn x·ª≠ l√Ω
        </span>
      </div>
    </div>
  </div>

  <div class="stat-card animate-slide-up delay-5">
    <div class="stat-header">
      <div class="stat-icon" style="background: linear-gradient(135deg, #3B82F6, #60A5FA);">
        <i class="fas fa-map-marker-alt"></i>
      </div>
      <div class="stat-badge">
        <span class="badge-info">
          <i class="fas fa-check"></i> 100%
        </span>
      </div>
    </div>
    <div class="stat-body">
      <h3 class="stat-number" data-target="15">0</h3>
      <p class="stat-label">ƒêi·ªÉm thu gom ho·∫°t ƒë·ªông</p>
      <div class="stat-mini-grid">
        <div class="mini-metric">
          <span class="mini-icon">üéØ</span>
          <div>
            <strong>8,945</strong>
            <span>L∆∞·ª£t gh√©</span>
          </div>
        </div>
        <div class="mini-metric">
          <span class="mini-icon">‚è±Ô∏è</span>
          <div>
            <strong>12 ph√∫t</strong>
            <span>Th·ªùi gian ch·ªù</span>
          </div>
        </div>
      </div>
      <div class="stat-footer">
        <span class="stat-detail">
          <i class="fas fa-star"></i> 4.8/5.0 rating
        </span>
        <span class="stat-detail-right">
          <i class="fas fa-users"></i> 89% ƒë·∫ßy
        </span>
      </div>
    </div>
  </div>

  <div class="stat-card animate-slide-up delay-6">
    <div class="stat-header">
      <div class="stat-icon" style="background: linear-gradient(135deg, #14B8A6, #5EEAD4);">
        <i class="fas fa-globe"></i>
      </div>
      <div class="stat-badge">
        <span class="badge-success">
          <i class="fas fa-arrow-up"></i> +18.9%
        </span>
      </div>
    </div>
    <div class="stat-body">
      <h3 class="stat-number" data-target="1284">0</h3>
      <p class="stat-label">T·∫•n CO‚ÇÇ ƒë√£ gi·∫£m thi·ªÉu</p>
      <div class="stat-mini-grid">
        <div class="mini-metric">
          <span class="mini-icon">üå≥</span>
          <div>
            <strong>542</strong>
            <span>C√¢y c·ª©u ƒë∆∞·ª£c</span>
          </div>
        </div>
        <div class="mini-metric">
          <span class="mini-icon">üíß</span>
          <div>
            <strong>128K L</strong>
            <span>N∆∞·ªõc ti·∫øt ki·ªám</span>
          </div>
        </div>
      </div>
      <div class="stat-footer">
        <span class="stat-detail">
          <i class="fas fa-leaf"></i> 85% m·ª•c ti√™u
        </span>
        <span class="stat-detail-right">
          <i class="fas fa-award"></i> Xu·∫•t s·∫Øc
        </span>
      </div>
    </div>
  </div>

  <div class="stat-card animate-slide-up delay-7">
    <div class="stat-header">
      <div class="stat-icon" style="background: linear-gradient(135deg, #EC4899, #F472B6);">
        <i class="fas fa-heart"></i>
      </div>
      <div class="stat-badge">
        <span class="badge-success">
          <i class="fas fa-arrow-up"></i> +32.1%
        </span>
      </div>
    </div>
    <div class="stat-body">
      <h3 class="stat-number" data-target="892">0</h3>
      <p class="stat-label">Ng∆∞·ªùi tham gia th·ª≠ th√°ch</p>
      <div class="stat-mini-grid">
        <div class="mini-metric">
          <span class="mini-icon">üèÜ</span>
          <div>
            <strong>234</strong>
            <span>Ho√†n th√†nh</span>
          </div>
        </div>
        <div class="mini-metric">
          <span class="mini-icon">‚ö°</span>
          <div>
            <strong>658</strong>
            <span>ƒêang ch∆°i</span>
          </div>
        </div>
      </div>
      <div class="stat-footer">
        <span class="stat-detail">
          <i class="fas fa-calendar"></i> C√≤n 5 ng√†y
        </span>
        <span class="stat-detail-right">
          <i class="fas fa-gift"></i> 50 gi·∫£i th∆∞·ªüng
        </span>
      </div>
    </div>
  </div>
</div>



<!-- ENVIRONMENTAL IMPACT -->
<div class="environmental-impact-section">
  <div class="section-header-inline">
    <div>
      <h2><i class="fas fa-earth-americas"></i> T√°c ƒë·ªông m√¥i tr∆∞·ªùng</h2>
      <p class="section-subtitle">üå± Th√†nh t·ª±u b·∫£o v·ªá m√¥i tr∆∞·ªùng t·ª´ ho·∫°t ƒë·ªông ph√¢n lo·∫°i r√°c</p>
    </div>
    <button class="btn-secondary">
      <i class="fas fa-chart-line"></i> B√°o c√°o chi ti·∫øt
    </button>
  </div>

  <div class="impact-cards-grid">
    <div class="impact-card">
      <div class="impact-icon" style="background: linear-gradient(135deg, #10B981, #059669);">
        <i class="fas fa-cloud"></i>
      </div>
      <div class="impact-content">
        <h3 class="impact-value">1,284 kg</h3>
        <p class="impact-label">CO‚ÇÇ ƒë√£ gi·∫£m thi·ªÉu</p>
        <div class="impact-comparison">
          <i class="fas fa-equals"></i>
          <span>T∆∞∆°ng ƒë∆∞∆°ng 5,420 km l√°i xe</span>
        </div>
      </div>
      <div class="impact-progress">
        <div class="progress-bar">
          <div class="progress-fill" style="width: 68%; background: #10B981;"></div>
        </div>
        <span class="progress-text">68% m·ª•c ti√™u th√°ng</span>
      </div>
    </div>

    <div class="impact-card">
      <div class="impact-icon" style="background: linear-gradient(135deg, #059669, #047857);">
        <i class="fas fa-tree"></i>
      </div>
      <div class="impact-content">
        <h3 class="impact-value">48 c√¢y</h3>
        <p class="impact-label">S·ªë c√¢y ƒë∆∞·ª£c c·ª©u</p>
        <div class="impact-comparison">
          <i class="fas fa-equals"></i>
          <span>T·ª´ 856 kg gi·∫•y t√°i ch·∫ø</span>
        </div>
      </div>
      <div class="impact-progress">
        <div class="progress-bar">
          <div class="progress-fill" style="width: 72%; background: #059669;"></div>
        </div>
        <span class="progress-text">72% m·ª•c ti√™u th√°ng</span>
      </div>
    </div>

    <div class="impact-card">
      <div class="impact-icon" style="background: linear-gradient(135deg, #F59E0B, #D97706);">
        <i class="fas fa-bolt"></i>
      </div>
      <div class="impact-content">
        <h3 class="impact-value">3,456 kWh</h3>
        <p class="impact-label">NƒÉng l∆∞·ª£ng ti·∫øt ki·ªám</p>
        <div class="impact-comparison">
          <i class="fas fa-equals"></i>
          <span>ƒê·ªß d√πng 115 h·ªô gia ƒë√¨nh/ng√†y</span>
        </div>
      </div>
      <div class="impact-progress">
        <div class="progress-bar">
          <div class="progress-fill" style="width: 85%; background: #F59E0B;"></div>
        </div>
        <span class="progress-text">85% m·ª•c ti√™u th√°ng</span>
      </div>
    </div>

    <div class="impact-card">
      <div class="impact-icon" style="background: linear-gradient(135deg, #3B82F6, #2563EB);">
        <i class="fas fa-droplet"></i>
      </div>
      <div class="impact-content">
        <h3 class="impact-value">12,890 L</h3>
        <p class="impact-label">N∆∞·ªõc ti·∫øt ki·ªám</p>
        <div class="impact-comparison">
          <i class="fas fa-equals"></i>
          <span>ƒê·ªß cho 43 ng∆∞·ªùi d√πng/ng√†y</span>
        </div>
      </div>
      <div class="impact-progress">
        <div class="progress-bar">
          <div class="progress-fill" style="width: 61%; background: #3B82F6;"></div>
        </div>
        <span class="progress-text">61% m·ª•c ti√™u th√°ng</span>
      </div>
    </div>
  </div>
</div>

<!-- AI PERFORMANCE SECTION -->
<div class="ai-performance-section">
  <!-- Header v·ªõi Summary c√πng 1 h√†ng -->
  <div class="section-header-inline">
    <div>
      <h2>
        <i class="fas fa-brain"></i> 
        Hi·ªáu su·∫•t AI
      </h2>
      <p class="section-subtitle">ü§ñ Th·ªëng k√™ ƒë·ªô ch√≠nh x√°c v√† hi·ªáu qu·∫£ nh·∫≠n di·ªán</p>
    </div>
    
    <div class="performance-summary">
      <div class="summary-badge excellent">
        <i class="fas fa-circle-check"></i>
        <span>Tr·∫°ng th√°i: <strong>Xu·∫•t s·∫Øc</strong></span>
      </div>
      <div class="summary-stat">
        <span class="value">94.2%</span>
        <span class="label">ƒê·ªô ch√≠nh x√°c trung b√¨nh</span>
      </div>
    </div>
  </div>

  <!-- Grid 2 c·ªôt -->
  <div class="ai-cards-grid">
    <!-- Card 1: ƒê·ªô ch√≠nh x√°c theo lo·∫°i -->
    <div class="ai-card">
      <div class="ai-card-header">
        <h4><i class="fas fa-bullseye"></i> ƒê·ªô ch√≠nh x√°c theo lo·∫°i</h4>
        <span class="ai-badge success">T·ªët</span>
      </div>
      <div class="ai-card-body">
        <div class="accuracy-item">
          <div class="accuracy-info">
            <span class="category-name">
              <i class="fas fa-recycle" style="color: #5865F2;"></i> T√°i ch·∫ø
            </span>
            <span class="accuracy-value">96.8%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: 96.8%; background: #5865F2;"></div>
          </div>
          <span class="accuracy-note">12,458 m·∫´u nh·∫≠n di·ªán</span>
        </div>

        <div class="accuracy-item">
          <div class="accuracy-info">
            <span class="category-name">
              <i class="fas fa-leaf" style="color: #10B981;"></i> H·ªØu c∆°
            </span>
            <span class="accuracy-value">93.4%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: 93.4%; background: #10B981;"></div>
          </div>
          <span class="accuracy-note">8,234 m·∫´u nh·∫≠n di·ªán</span>
        </div>

        <div class="accuracy-item">
          <div class="accuracy-info">
            <span class="category-name">
              <i class="fas fa-skull-crossbones" style="color: #EF4444;"></i> Nguy h·∫°i
            </span>
            <span class="accuracy-value">98.1%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: 98.1%; background: #EF4444;"></div>
          </div>
          <span class="accuracy-note">1,892 m·∫´u nh·∫≠n di·ªán</span>
        </div>

        <div class="accuracy-item">
          <div class="accuracy-info">
            <span class="category-name">
              <i class="fas fa-trash" style="color: #F59E0B;"></i> C√≤n l·∫°i
            </span>
            <span class="accuracy-value">89.5%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: 89.5%; background: #F59E0B;"></div>
          </div>
          <span class="accuracy-note">3,567 m·∫´u nh·∫≠n di·ªán</span>
        </div>
      </div>
    </div>

    <!-- Card 2: L·ªói ph·ªï bi·∫øn -->
    <div class="ai-card">
      <div class="ai-card-header">
        <h4><i class="fas fa-exclamation-circle"></i> L·ªói ph·ªï bi·∫øn c·∫ßn c·∫£i thi·ªán</h4>
        <button class="btn-retrain">
          <i class="fas fa-rotate"></i> Hu·∫•n luy·ªán l·∫°i
        </button>
      </div>
      <div class="ai-card-body">
        <div class="misclassification-list">
          <div class="misclass-item">
            <div class="misclass-icons">
              <span class="icon-from">ü•§</span>
              <i class="fas fa-arrow-right"></i>
              <span class="icon-to">üç∂</span>
            </div>
            <div class="misclass-info">
              <p class="misclass-desc">
                <strong>Ly nh·ª±a</strong> b·ªã nh·∫ßm th√†nh <strong>Chai th·ªßy tinh</strong>
              </p>
              <span class="misclass-rate">245 l·∫ßn (1.8%)</span>
            </div>
            <button class="btn-fix-icon" title="Xem chi ti·∫øt">
              <i class="fas fa-wrench"></i>
            </button>
          </div>

          <div class="misclass-item">
            <div class="misclass-icons">
              <span class="icon-from">üçå</span>
              <i class="fas fa-arrow-right"></i>
              <span class="icon-to">üóëÔ∏è</span>
            </div>
            <div class="misclass-info">
              <p class="misclass-desc">
                <strong>V·ªè tr√°i c√¢y</strong> b·ªã nh·∫ßm th√†nh <strong>R√°c th∆∞·ªùng</strong>
              </p>
              <span class="misclass-rate">189 l·∫ßn (1.4%)</span>
            </div>
            <button class="btn-fix-icon">
              <i class="fas fa-wrench"></i>
            </button>
          </div>

          <div class="misclass-item">
            <div class="misclass-icons">
              <span class="icon-from">üì¶</span>
              <i class="fas fa-arrow-right"></i>
              <span class="icon-to">üìÑ</span>
            </div>
            <div class="misclass-info">
              <p class="misclass-desc">
                <strong>H·ªôp carton b·∫©n</strong> b·ªã nh·∫ßm th√†nh <strong>Gi·∫•y s·∫°ch</strong>
              </p>
              <span class="misclass-rate">156 l·∫ßn (1.2%)</span>
            </div>
            <button class="btn-fix-icon">
              <i class="fas fa-wrench"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Card 3: Chart (Full width) -->
    <div class="ai-card full-width">
      <div class="ai-card-header">
        <h4><i class="fas fa-chart-area"></i> Xu h∆∞·ªõng ƒë·ªô ch√≠nh x√°c 30 ng√†y</h4>
        <div class="timeline-controls">
          <button class="btn-timeline active" data-period="7d">7 ng√†y</button>
          <button class="btn-timeline" data-period="30d">30 ng√†y</button>
          <button class="btn-timeline" data-period="90d">90 ng√†y</button>
        </div>
      </div>
      <div class="ai-card-body">
        <canvas id="aiAccuracyTrendChart"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- CHARTS ROW 1 -->
<div class="charts-row">
  <div class="chart-card">
    <div class="card-header">
      <div>
        <h3><i class="fas fa-chart-pie"></i> Ph√¢n b·ªë lo·∫°i r√°c</h3>
        <p class="card-subtitle">T·ª∑ l·ªá ph√¢n lo·∫°i 7 ng√†y qua</p>
      </div>
      <div class="card-actions">
        <select class="filter-select">
          <option>7 ng√†y qua</option>
          <option>30 ng√†y qua</option>
        </select>
        <button class="btn-icon">
          <i class="fas fa-download"></i>
        </button>
      </div>
    </div>
    <div class="card-body">
      <canvas id="wasteDistChart" height="280"></canvas>
    </div>
    <div class="card-footer">
      <div class="chart-legend-grid">
        <div class="legend-item">
          <span class="legend-dot" style="background: #5865F2;"></span>
          <span>T√°i ch·∫ø: <strong>42%</strong></span>
        </div>
        <div class="legend-item">
          <span class="legend-dot" style="background: #10B981;"></span>
          <span>H·ªØu c∆°: <strong>35%</strong></span>
        </div>
        <div class="legend-item">
          <span class="legend-dot" style="background: #EF4444;"></span>
          <span>Nguy h·∫°i: <strong>8%</strong></span>
        </div>
        <div class="legend-item">
          <span class="legend-dot" style="background: #F59E0B;"></span>
          <span>C√≤n l·∫°i: <strong>15%</strong></span>
        </div>
      </div>
    </div>
  </div>

  <div class="chart-card">
    <div class="card-header">
      <div>
        <h3><i class="fas fa-chart-line"></i> Xu h∆∞·ªõng tham gia</h3>
        <p class="card-subtitle">Ng∆∞·ªùi d√πng m·ªõi & L∆∞·ª£ng r√°c ph√¢n lo·∫°i</p>
      </div>
      <div class="card-actions">
        <select class="filter-select">
          <option>6 th√°ng qua</option>
          <option>1 nƒÉm qua</option>
        </select>
        <button class="btn-icon">
          <i class="fas fa-expand"></i>
        </button>
      </div>
    </div>
    <div class="card-body">
      <canvas id="monthlyTrendChart" height="280"></canvas>
    </div>
    <div class="card-footer">
      <div class="chart-stats-row">
        <div class="chart-stat">
          <span class="stat-icon" style="color: #5865F2;">
            <i class="fas fa-arrow-trend-up"></i>
          </span>
          <div>
            <p class="stat-value">+28.5%</p>
            <p class="stat-text">TƒÉng tr∆∞·ªüng</p>
          </div>
        </div>
        <div class="chart-stat">
          <span class="stat-icon" style="color: #10B981;">
            <i class="fas fa-users"></i>
          </span>
          <div>
            <p class="stat-value">1,247</p>
            <p class="stat-text">Ng∆∞·ªùi d√πng</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- CHARTS ROW 2 -->
<div class="charts-row">
  <div class="chart-card">
    <div class="card-header">
      <div>
        <h3><i class="fas fa-clock"></i> Ho·∫°t ƒë·ªông theo gi·ªù</h3>
        <p class="card-subtitle">L∆∞·ª£t qu√©t AI trong tu·∫ßn</p>
      </div>
      <button class="btn-icon">
        <i class="fas fa-info-circle"></i>
      </button>
    </div>
    <div class="card-body">
      <div class="heatmap-container">
        <div class="heatmap-row">
          <span class="heatmap-label">Th·ª© 2</span>
          <div class="heatmap-cells">
            <div class="heatmap-cell" data-value="45" style="background: rgba(88, 101, 242, 0.3);"></div>
            <div class="heatmap-cell" data-value="78" style="background: rgba(88, 101, 242, 0.5);"></div>
            <div class="heatmap-cell" data-value="92" style="background: rgba(88, 101, 242, 0.7);"></div>
            <div class="heatmap-cell" data-value="120" style="background: rgba(88, 101, 242, 0.9);"></div>
            <div class="heatmap-cell" data-value="156" style="background: rgba(88, 101, 242, 1);"></div>
            <div class="heatmap-cell" data-value="134" style="background: rgba(88, 101, 242, 0.8);"></div>
          </div>
        </div>
        <div class="heatmap-row">
          <span class="heatmap-label">Th·ª© 3</span>
          <div class="heatmap-cells">
            <div class="heatmap-cell" data-value="52" style="background: rgba(88, 101, 242, 0.35);"></div>
            <div class="heatmap-cell" data-value="89" style="background: rgba(88, 101, 242, 0.6);"></div>
            <div class="heatmap-cell" data-value="105" style="background: rgba(88, 101, 242, 0.75);"></div>
            <div class="heatmap-cell" data-value="142" style="background: rgba(88, 101, 242, 0.95);"></div>
            <div class="heatmap-cell" data-value="178" style="background: rgba(88, 101, 242, 1);"></div>
            <div class="heatmap-cell" data-value="121" style="background: rgba(88, 101, 242, 0.75);"></div>
          </div>
        </div>
        <div class="heatmap-row">
          <span class="heatmap-label">Th·ª© 4</span>
          <div class="heatmap-cells">
            <div class="heatmap-cell" data-value="68" style="background: rgba(88, 101, 242, 0.45);"></div>
            <div class="heatmap-cell" data-value="108" style="background: rgba(88, 101, 242, 0.65);"></div>
            <div class="heatmap-cell" data-value="138" style="background: rgba(88, 101, 242, 0.8);"></div>
            <div class="heatmap-cell" data-value="165" style="background: rgba(88, 101, 242, 0.9);"></div>
            <div class="heatmap-cell" data-value="192" style="background: rgba(88, 101, 242, 1);"></div>
            <div class="heatmap-cell" data-value="158" style="background: rgba(88, 101, 242, 0.85);"></div>
          </div>
        </div>
      </div>
      <div class="heatmap-legend">
        <span>√çt</span>
        <div class="heatmap-gradient"></div>
        <span>Nhi·ªÅu</span>
      </div>
    </div>
  </div>

  <div class="chart-card">
    <div class="card-header">
      <div>
        <h3><i class="fas fa-location-dot"></i> Top ƒëi·ªÉm thu gom</h3>
        <p class="card-subtitle">L∆∞·ª£ng r√°c thu ƒë∆∞·ª£c (kg)</p>
      </div>
      <select class="filter-select">
        <option>Tu·∫ßn n√†y</option>
        <option>Th√°ng n√†y</option>
      </select>
    </div>
    <div class="card-body">
      <canvas id="collectionPointsChart" height="280"></canvas>
    </div>
  </div>
</div>

<!-- ============================================
     BOTTOM SECTION - LAYOUT M·ªöI
     ============================================ -->

<!-- Row 1: Activities + Top Users -->
<div class="bottom-row-activities">
  <!-- Recent Activities (60% width) -->
  <!-- Recent Activities (60% width) - N√ÇNG C·∫§P -->
<div class="activity-card">
  <div class="card-header">
    <div>
      <h3><i class="fas fa-stream"></i> Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y</h3>
      <p class="card-subtitle-small">
        <i class="fas fa-circle-dot" style="color: #10B981;"></i> C·∫≠p nh·∫≠t real-time ‚Ä¢ 
        <strong>245</strong> ho·∫°t ƒë·ªông h√¥m nay
      </p>
    </div>
    <div class="activity-filters">
      <select class="filter-dropdown">
        <option>T·∫•t c·∫£</option>
        <option>Qu√©t AI</option>
        <option>Thu gom</option>
        <option>ƒê·ªïi qu√†</option>
      </select>
      <a href="#" class="view-all">Xem t·∫•t c·∫£ <i class="fas fa-arrow-right"></i></a>
    </div>
  </div>
  
  <!-- Stats Summary -->
  <div class="activity-stats-bar">
    <div class="activity-stat-item">
      <span class="stat-icon" style="background: rgba(139, 92, 246, 0.1); color: #8B5CF6;">
        <i class="fas fa-camera"></i>
      </span>
      <div>
        <strong>89</strong>
        <span>Qu√©t AI</span>
      </div>
    </div>
    <div class="activity-stat-item">
      <span class="stat-icon" style="background: rgba(16, 185, 129, 0.1); color: #10B981;">
        <i class="fas fa-recycle"></i>
      </span>
      <div>
        <strong>124</strong>
        <span>Thu gom</span>
      </div>
    </div>
    <div class="activity-stat-item">
      <span class="stat-icon" style="background: rgba(245, 158, 11, 0.1); color: #F59E0B;">
        <i class="fas fa-gift"></i>
      </span>
      <div>
        <strong>32</strong>
        <span>ƒê·ªïi qu√†</span>
      </div>
    </div>
    <div class="activity-stat-item">
      <span class="stat-icon" style="background: rgba(239, 68, 68, 0.1); color: #EF4444;">
        <i class="fas fa-trophy"></i>
      </span>
      <div>
        <strong>15</strong>
        <span>Th√†nh t·ª±u</span>
      </div>
    </div>
  </div>

  <div class="card-body">
    <div class="activity-list">
      <!-- Activity 1: AI Scan -->
      <div class="activity-item">
        <div class="activity-avatar">
          <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="User">
          <span class="activity-badge scan">
            <i class="fas fa-camera"></i>
          </span>
        </div>
        <div class="activity-content">
          <div class="activity-header">
            <strong>Nguy·ªÖn Th·ªã Mai</strong>
            <span class="activity-type-badge scan">
              <i class="fas fa-camera"></i> Qu√©t AI
            </span>
          </div>
          <p>ƒê√£ qu√©t nh·∫≠n di·ªán <span class="highlight">Chai nh·ª±a PET</span></p>
          <div class="activity-meta">
            <span class="activity-time">
              <i class="fas fa-clock"></i> 2 ph√∫t tr∆∞·ªõc
            </span>
            <span class="activity-location">
              <i class="fas fa-location-dot"></i> ƒê√† L·∫°t
            </span>
            <span class="activity-accuracy">
              <i class="fas fa-check-circle"></i> 98.5% ch√≠nh x√°c
            </span>
          </div>
        </div>
        <div class="activity-points">
          +15 <i class="fas fa-coins"></i>
        </div>
      </div>

      <!-- Activity 2: Collection -->
      <div class="activity-item">
        <div class="activity-avatar">
          <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="User">
          <span class="activity-badge collect">
            <i class="fas fa-recycle"></i>
          </span>
        </div>
        <div class="activity-content">
          <div class="activity-header">
            <strong>Tr·∫ßn VƒÉn Nam</strong>
            <span class="activity-type-badge collect">
              <i class="fas fa-recycle"></i> Thu gom
            </span>
          </div>
          <p>ƒê√£ n·ªôp <span class="highlight">5.2 kg r√°c t√°i ch·∫ø</span> t·∫°i <strong>ƒêi·ªÉm A</strong></p>
          <div class="activity-meta">
            <span class="activity-time">
              <i class="fas fa-clock"></i> 15 ph√∫t tr∆∞·ªõc
            </span>
            <span class="activity-location">
              <i class="fas fa-map-marker-alt"></i> THPT Yersin
            </span>
            <span class="activity-co2">
              <i class="fas fa-leaf"></i> -12.4 kg CO‚ÇÇ
            </span>
          </div>
        </div>
        <div class="activity-points">
          +52 <i class="fas fa-coins"></i>
        </div>
      </div>

      <!-- Activity 3: Reward -->
      <div class="activity-item">
        <div class="activity-avatar">
          <img src="https://randomuser.me/api/portraits/women/68.jpg" alt="User">
          <span class="activity-badge reward">
            <i class="fas fa-gift"></i>
          </span>
        </div>
        <div class="activity-content">
          <div class="activity-header">
            <strong>L√™ Thu H√†</strong>
            <span class="activity-type-badge reward">
              <i class="fas fa-gift"></i> ƒê·ªïi qu√†
            </span>
          </div>
          <p>ƒê√£ ƒë·ªïi qu√† <span class="highlight">T√∫i v·∫£i canvas</span></p>
          <div class="activity-meta">
            <span class="activity-time">
              <i class="fas fa-clock"></i> 1 gi·ªù tr∆∞·ªõc
            </span>
            <span class="activity-stock">
              <i class="fas fa-box"></i> C√≤n 247 s·∫£n ph·∫©m
            </span>
            <span class="activity-rank">
              <i class="fas fa-star"></i> Th√†nh vi√™n V√†ng
            </span>
          </div>
        </div>
        <div class="activity-points negative">
          -500 <i class="fas fa-coins"></i>
        </div>
      </div>

      <!-- Activity 4: Achievement -->
      <div class="activity-item">
        <div class="activity-avatar">
          <img src="https://randomuser.me/api/portraits/men/52.jpg" alt="User">
          <span class="activity-badge achievement">
            <i class="fas fa-trophy"></i>
          </span>
        </div>
        <div class="activity-content">
          <div class="activity-header">
            <strong>Ph·∫°m Minh Tu·∫•n</strong>
            <span class="activity-type-badge achievement">
              <i class="fas fa-trophy"></i> Th√†nh t·ª±u
            </span>
          </div>
          <p>ƒê·∫°t th√†nh t·ª±u <span class="highlight">üèÜ Eco Warrior</span></p>
          <div class="activity-meta">
            <span class="activity-time">
              <i class="fas fa-clock"></i> 3 gi·ªù tr∆∞·ªõc
            </span>
            <span class="activity-milestone">
              <i class="fas fa-fire"></i> 100 l∆∞·ª£t qu√©t
            </span>
            <span class="activity-streak">
              <i class="fas fa-calendar-check"></i> 30 ng√†y li√™n t·ª•c
            </span>
          </div>
        </div>
        <div class="activity-badge-icon">
          üèÜ
        </div>
      </div>

      <!-- Activity 5: Referral -->
      <div class="activity-item">
        <div class="activity-avatar">
          <img src="https://randomuser.me/api/portraits/women/28.jpg" alt="User">
          <span class="activity-badge referral">
            <i class="fas fa-user-plus"></i>
          </span>
        </div>
        <div class="activity-content">
          <div class="activity-header">
            <strong>Ho√†ng Lan Anh</strong>
            <span class="activity-type-badge referral">
              <i class="fas fa-user-plus"></i> Gi·ªõi thi·ªáu
            </span>
          </div>
          <p>ƒê√£ m·ªùi <span class="highlight">3 b·∫°n b√®</span> tham gia</p>
          <div class="activity-meta">
            <span class="activity-time">
              <i class="fas fa-clock"></i> 5 gi·ªù tr∆∞·ªõc
            </span>
            <span class="activity-referral">
              <i class="fas fa-users"></i> 8 ng∆∞·ªùi ƒë√£ tham gia
            </span>
            <span class="activity-bonus">
              <i class="fas fa-rocket"></i> Bonus x2
            </span>
          </div>
        </div>
        <div class="activity-points">
          +150 <i class="fas fa-coins"></i>
        </div>
      </div>

      <!-- Activity 6: Challenge -->
      <div class="activity-item">
        <div class="activity-avatar">
          <img src="https://randomuser.me/api/portraits/men/75.jpg" alt="User">
          <span class="activity-badge challenge">
            <i class="fas fa-flag-checkered"></i>
          </span>
        </div>
        <div class="activity-content">
          <div class="activity-header">
            <strong>L√™ Minh Kh√¥i</strong>
            <span class="activity-type-badge challenge">
              <i class="fas fa-flag-checkered"></i> Th·ª≠ th√°ch
            </span>
          </div>
          <p>Ho√†n th√†nh <span class="highlight">Th·ª≠ th√°ch tu·∫ßn #12</span></p>
          <div class="activity-meta">
            <span class="activity-time">
              <i class="fas fa-clock"></i> 8 gi·ªù tr∆∞·ªõc
            </span>
            <span class="activity-progress">
              <i class="fas fa-chart-line"></i> 15/15 m·ª•c ti√™u
            </span>
            <span class="activity-reward-bonus">
              <i class="fas fa-gift"></i> +3 ph·∫ßn qu√†
            </span>
          </div>
        </div>
        <div class="activity-points">
          +300 <i class="fas fa-coins"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer with pagination -->
  <div class="activity-footer">
    <div class="activity-summary">
      <i class="fas fa-chart-bar"></i>
      Hi·ªÉn th·ªã <strong>6</strong> / <strong>245</strong> ho·∫°t ƒë·ªông
    </div>
    <button class="btn-load-more">
      <i class="fas fa-rotate"></i> T·∫£i th√™m
    </button>
  </div>
</div>


  <!-- Top Users (40% width) -->
  <div class="top-users-card">
    <div class="card-header">
      <div>
        <h3><i class="fas fa-ranking-star"></i> Top 5 tu·∫ßn n√†y</h3>
        <p class="card-subtitle-small">B·∫£ng x·∫øp h·∫°ng ng∆∞·ªùi d√πng</p>
      </div>
      <a href="#" class="view-all">Chi ti·∫øt <i class="fas fa-arrow-right"></i></a>
    </div>
    <div class="card-body">
      <div class="top-users-list">
        <div class="top-user-item rank-1">
          <div class="rank-badge gold">
            <i class="fas fa-crown"></i>
            <span>1</span>
          </div>
          <img src="https://randomuser.me/api/portraits/men/45.jpg" alt="User 1">
          <div class="user-info">
            <h4>Nguy·ªÖn VƒÉn A</h4>
            <p class="user-stats">
              <span><i class="fas fa-weight-hanging"></i> 45.8 kg</span>
              <span><i class="fas fa-coins"></i> 1,247 ƒëi·ªÉm</span>
            </p>
          </div>
          <div class="user-trend">
            <i class="fas fa-arrow-up"></i> +3
          </div>
        </div>

        <div class="top-user-item rank-2">
          <div class="rank-badge silver">
            <span>2</span>
          </div>
          <img src="https://randomuser.me/api/portraits/women/65.jpg" alt="User 2">
          <div class="user-info">
            <h4>Tr·∫ßn Th·ªã B</h4>
            <p class="user-stats">
              <span><i class="fas fa-weight-hanging"></i> 42.3 kg</span>
              <span><i class="fas fa-coins"></i> 1,156 ƒëi·ªÉm</span>
            </p>
          </div>
          <div class="user-trend down">
            <i class="fas fa-arrow-down"></i> -1
          </div>
        </div>

        <div class="top-user-item rank-3">
          <div class="rank-badge bronze">
            <span>3</span>
          </div>
          <img src="https://randomuser.me/api/portraits/men/75.jpg" alt="User 3">
          <div class="user-info">
            <h4>L√™ VƒÉn C</h4>
            <p class="user-stats">
              <span><i class="fas fa-weight-hanging"></i> 38.9 kg</span>
              <span><i class="fas fa-coins"></i> 1,089 ƒëi·ªÉm</span>
            </p>
          </div>
          <div class="user-trend">
            <i class="fas fa-arrow-up"></i> +2
          </div>
        </div>

        <div class="top-user-item">
          <div class="rank-badge">4</div>
          <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="User 4">
          <div class="user-info">
            <h4>Ph·∫°m Thu D</h4>
            <p class="user-stats">
              <span><i class="fas fa-weight-hanging"></i> 35.2 kg</span>
              <span><i class="fas fa-coins"></i> 945 ƒëi·ªÉm</span>
            </p>
          </div>
          <div class="user-trend">
            <i class="fas fa-minus"></i> 0
          </div>
        </div>

        <div class="top-user-item">
          <div class="rank-badge">5</div>
          <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="User 5">
          <div class="user-info">
            <h4>Ho√†ng Minh E</h4>
            <p class="user-stats">
              <span><i class="fas fa-weight-hanging"></i> 32.7 kg</span>
              <span><i class="fas fa-coins"></i> 892 ƒëi·ªÉm</span>
            </p>
          </div>
          <div class="user-trend">
            <i class="fas fa-arrow-up"></i> +1
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Row 2: Interactive Map with Collection Points -->
<div class="bottom-row-map">
  <div class="map-card">
    <div class="card-header">
      <div>
        <h3><i class="fas fa-map-marked-alt"></i> B·∫£n ƒë·ªì ƒëi·ªÉm thu gom r√°c</h3>
        <p class="card-subtitle-small">
          <i class="fas fa-circle-dot" style="color: #10B981;"></i> 
          <strong id="activePointsCount">15</strong> ƒëi·ªÉm ƒëang ho·∫°t ƒë·ªông ‚Ä¢ C·∫≠p nh·∫≠t real-time
        </p>
      </div>
      <div class="map-actions">
        <button class="btn-icon" onclick="centerMap()" title="V·ªÅ trung t√¢m">
          <i class="fas fa-crosshairs"></i>
        </button>
        <button class="btn-icon" onclick="toggleClustering()" title="B·∫≠t/T·∫Øt gom c·ª•m">
          <i class="fas fa-object-group"></i>
        </button>
        <button class="btn-icon" onclick="refreshMapData()" title="L√†m m·ªõi">
          <i class="fas fa-rotate"></i>
        </button>
      </div>
    </div>
    
    <!-- Map Stats Bar -->
    <div class="map-stats-bar">
      <div class="map-stat-item">
        <i class="fas fa-location-dot" style="color: #10B981;"></i>
        <div>
          <strong id="statsActive">15</strong>
          <span>Ho·∫°t ƒë·ªông</span>
        </div>
      </div>
      <div class="map-stat-item">
        <i class="fas fa-exclamation-triangle" style="color: #F59E0B;"></i>
        <div>
          <strong id="statsWarning">3</strong>
          <span>G·∫ßn ƒë·∫ßy</span>
        </div>
      </div>
      <div class="map-stat-item">
        <i class="fas fa-pause-circle" style="color: #9CA3AF;"></i>
        <div>
          <strong id="statsInactive">2</strong>
          <span>T·∫°m ng·ª´ng</span>
        </div>
      </div>
      <div class="map-stat-item">
        <i class="fas fa-weight-hanging" style="color: #3B82F6;"></i>
        <div>
          <strong id="statsTotal">1,819 kg</strong>
          <span>T·ªïng thu gom</span>
        </div>
      </div>
    </div>

    <div class="card-body" style="padding: 0; position: relative;">
      <!-- Leaflet Map Container -->
      <div id="leafletMap" class="map-container-3d"></div>
      
      <!-- Map Filter Controls -->
      <div class="map-filter-controls">
        <div class="filter-group">
          <label class="filter-checkbox">
            <input type="checkbox" checked data-status="active">
            <span class="filter-label">
              <span class="filter-dot active"></span> Ho·∫°t ƒë·ªông
            </span>
          </label>
          <label class="filter-checkbox">
            <input type="checkbox" checked data-status="warning">
            <span class="filter-label">
              <span class="filter-dot warning"></span> G·∫ßn ƒë·∫ßy
            </span>
          </label>
          <label class="filter-checkbox">
            <input type="checkbox" checked data-status="inactive">
            <span class="filter-label">
              <span class="filter-dot inactive"></span> T·∫°m ng·ª´ng
            </span>
          </label>
        </div>
      </div>
    </div>
    
    <div class="card-footer">
      <div class="map-legend-enhanced">
        <div class="legend-item">
          <span class="legend-marker active"></span>
          <span>Ho·∫°t ƒë·ªông t·ªët (<span id="legendActive">15</span>)</span>
        </div>
        <div class="legend-item">
          <span class="legend-marker warning"></span>
          <span>G·∫ßn ƒë·∫ßy (<span id="legendWarning">3</span>)</span>
        </div>
        <div class="legend-item">
          <span class="legend-marker inactive"></span>
          <span>T·∫°m ng·ª´ng (<span id="legendInactive">2</span>)</span>
        </div>
        <div class="legend-item">
          <i class="fas fa-info-circle" style="color: #6B7280; margin-right: 6px;"></i>
          <span>Click v√†o marker ƒë·ªÉ xem chi ti·∫øt</span>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- ALERTS -->
<div class="alerts-section">
  <div class="alert-card warning">
    <div class="alert-icon">
      <i class="fas fa-exclamation-triangle"></i>
    </div>
    <div class="alert-content">
      <h4>‚ö†Ô∏è C·∫£nh b√°o: ƒêi·ªÉm thu gom "Ch·ª£ ƒê√† L·∫°t" s·∫Øp ƒë·∫ßy</h4>
      <p>C√≤n 15% dung l∆∞·ª£ng. C·∫ßn thu gom trong v√≤ng 24 gi·ªù.</p>
    </div>
    <button class="btn-alert-action">X·ª≠ l√Ω ngay</button>
  </div>

  <div class="alert-card info">
    <div class="alert-icon">
      <i class="fas fa-lightbulb"></i>
    </div>
    <div class="alert-content">
      <h4>üí° G·ª£i √Ω: Th·ª≠ th√°ch th√°ng n√†y s·∫Øp k·∫øt th√∫c</h4>
      <p>C√≤n 5 ng√†y. 892 ng∆∞·ªùi d√πng ƒëang tham gia.</p>
    </div>
    <button class="btn-alert-action">Xem chi ti·∫øt</button>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
// Counter Animation
const counters = document.querySelectorAll('.stat-number');
counters.forEach(counter => {
  const target = parseInt(counter.getAttribute('data-target'));
  const duration = 2000;
  const increment = target / (duration / 16);
  let current = 0;
  
  const updateCounter = () => {
    current += increment;
    if (current < target) {
      counter.textContent = Math.floor(current).toLocaleString('vi-VN');
      requestAnimationFrame(updateCounter);
    } else {
      counter.textContent = target.toLocaleString('vi-VN');
    }
  };
  
  updateCounter();
});

// Timeline buttons
document.querySelectorAll('.btn-timeline').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.btn-timeline').forEach(b => b.classList.remove('active'));
    this.classList.add('active');
  });
});

// Charts initialization
const ctx1 = document.getElementById('wasteDistChart');
if (ctx1) {
  new Chart(ctx1, {
    type: 'doughnut',
    data: {
      labels: ['T√°i ch·∫ø', 'H·ªØu c∆°', 'Nguy h·∫°i', 'C√≤n l·∫°i'],
      datasets: [{
        data: [42, 35, 8, 15],
        backgroundColor: ['#5865F2', '#10B981', '#EF4444', '#F59E0B'],
        borderWidth: 2,
        borderColor: '#fff'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false }
      }
    }
  });
}

const ctx2 = document.getElementById('monthlyTrendChart');
if (ctx2) {
  new Chart(ctx2, {
    type: 'line',
    data: {
      labels: ['T7', 'T8', 'T9', 'T10', 'T11', 'T12'],
      datasets: [{
        label: 'Ng∆∞·ªùi d√πng',
        data: [820, 932, 1018, 1156, 1289, 1432],
        borderColor: '#5865F2',
        backgroundColor: 'rgba(88, 101, 242, 0.1)',
        tension: 0.4,
        fill: true
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false }
      }
    }
  });
}

const ctx3 = document.getElementById('collectionPointsChart');
if (ctx3) {
  new Chart(ctx3, {
    type: 'bar',
    data: {
      labels: ['THPT Yersin', 'ƒêH ƒê√† L·∫°t', 'Ch·ª£ ƒê√† L·∫°t', 'Si√™u th·ªã', 'C√¥ng vi√™n'],
      datasets: [{
        label: 'Kg',
        data: [342, 567, 289, 423, 198],
        backgroundColor: '#10B981',
        borderRadius: 8
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false }
      }
    }
  });
}

const ctx4 = document.getElementById('aiAccuracyTrendChart');
if (ctx4) {
  new Chart(ctx4, {
    type: 'line',
    data: {
      labels: ['1', '5', '10', '15', '20', '25', '30'],
      datasets: [{
        label: 'ƒê·ªô ch√≠nh x√°c',
        data: [91.2, 92.5, 93.1, 93.8, 94.0, 94.1, 94.2],
        borderColor: '#8B5CF6',
        backgroundColor: 'rgba(139, 92, 246, 0.1)',
        tension: 0.4,
        fill: true
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false }
      }
    }
  });
}

function exportReport() {
  alert('üì• ƒêang xu·∫•t b√°o c√°o...');
}

console.log('‚úÖ Dashboard initialized');
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<!-- ‚≠ê LEAFLET.JS - KH√îNG C·∫¶N API KEY ‚≠ê -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// ============================================
// LEAFLET MAP WITH COLLECTION POINTS
// ============================================
let leafletMap;
let markersLayer;
let allMarkers = [];

// D·ªØ li·ªáu ƒëi·ªÉm thu gom (c√≥ th·ªÉ load t·ª´ API)
const collectionPoints = [
  {
    id: 1,
    name: 'THPT Yersin',
    lat: 11.9404,
    lng: 108.4419,
    weight: 342,
    status: 'active',
    capacity: 78,
    address: 'ƒê∆∞·ªùng Yersin, Ph∆∞·ªùng 1, ƒê√† L·∫°t',
    contact: '0263.383.xxxx',
    hours: '7:00 - 18:00'
  },
  {
    id: 2,
    name: 'ƒêH ƒê√† L·∫°t',
    lat: 11.9494,
    lng: 108.4439,
    weight: 567,
    status: 'active',
    capacity: 92,
    address: 'Ph√π ƒê·ªïng Thi√™n V∆∞∆°ng, Ph∆∞·ªùng 8',
    contact: '0263.382.xxxx',
    hours: '6:00 - 20:00'
  },
  {
    id: 3,
    name: 'Ch·ª£ ƒê√† L·∫°t',
    lat: 11.9354,
    lng: 108.4370,
    weight: 289,
    status: 'warning',
    capacity: 95,
    address: 'Nguy·ªÖn Th·ªã Minh Khai, Ph∆∞·ªùng 1',
    contact: '0263.381.xxxx',
    hours: '5:00 - 19:00'
  },
  {
    id: 4,
    name: 'Si√™u th·ªã Big C',
    lat: 11.9444,
    lng: 108.4469,
    weight: 423,
    status: 'active',
    capacity: 65,
    address: 'ƒê·∫°i l·ªô H√πng V∆∞∆°ng, Ph∆∞·ªùng 9',
    contact: '0263.380.xxxx',
    hours: '8:00 - 22:00'
  },
  {
    id: 5,
    name: 'C√¥ng vi√™n Yersin',
    lat: 11.9374,
    lng: 108.4339,
    weight: 198,
    status: 'warning',
    capacity: 88,
    address: 'Tr·∫ßn Qu·ªëc To·∫£n, Ph∆∞·ªùng 1',
    contact: '0263.379.xxxx',
    hours: '6:00 - 21:00'
  },
  {
    id: 6,
    name: 'Tr∆∞·ªùng THCS Nguy·ªÖn Du',
    lat: 11.9524,
    lng: 108.4389,
    weight: 156,
    status: 'active',
    capacity: 45,
    address: 'Phan B·ªôi Ch√¢u, Ph∆∞·ªùng 2',
    contact: '0263.378.xxxx',
    hours: '7:00 - 17:00'
  },
  {
    id: 7,
    name: 'B·ªánh vi·ªán L√¢m ƒê·ªìng',
    lat: 11.9434,
    lng: 108.4289,
    weight: 234,
    status: 'inactive',
    capacity: 15,
    address: 'Ph·∫°m Ng·ªçc Th·∫°ch, Ph∆∞·ªùng 3',
    contact: '0263.377.xxxx',
    hours: 'ƒêang b·∫£o tr√¨'
  },
  {
    id: 8,
    name: 'Ch·ª£ ƒë√™m ƒê√† L·∫°t',
    lat: 11.9384,
    lng: 108.4329,
    weight: 445,
    status: 'warning',
    capacity: 92,
    address: 'Nguy·ªÖn Ch√≠ Thanh, Ph∆∞·ªùng 1',
    contact: '0263.376.xxxx',
    hours: '18:00 - 23:00'
  },
  // ‚≠ê TH√äM C√ÅC ƒêI·ªÇM M·ªöI ·ªû ƒê·∫†I H·ªåC ƒê√Ä L·∫†T ‚≠ê
  {
    id: 9,
    name: 'ƒêH ƒê√† L·∫°t - Khu A (Minh Th√†nh)',
    lat: 11.955311,
    lng: 108.443417,
    weight: 234,
    status: 'active',
    capacity: 68,
    address: 'Khu A - T√≤a Minh Th√†nh, ƒêH ƒê√† L·∫°t',
    contact: '0263.382.2246',
    hours: '7:00 - 17:00'
  },
  {
    id: 10,
    name: 'ƒêH ƒê√† L·∫°t - Trung T√¢m C√¥ng Ngh·ªá Th√¥ng Tin',
    lat: 11.956964, 
    lng: 108.44478,
    weight: 189,
    status: 'active',
    capacity: 52,
    address: 'Trung T√¢m C√¥ng Ngh·ªá Th√¥ng Tin, ƒêH ƒê√† L·∫°t',
    contact: '0263.382.2246',
    hours: '7:00 - 17:00'
  },
  {
    id: 11,
    name: 'ƒêH ƒê√† L·∫°t - Tr·ª• S·ªü DaLat-Hallym',
    lat: 11.956424, 
    lng: 108.444133,
    weight: 156,
    status: 'active',
    capacity: 45,
    address: 'Khu C - T√≤a Th·ª• Nh√¢n, ƒêH ƒê√† L·∫°t',
    contact: '0263.382.2246',
    hours: '7:00 - 17:00'
  },
  {
    id: 12,
    name: 'ƒêH ƒê√† L·∫°t - K√Ω t√∫c x√°',
    lat: 11.9524,
    lng: 108.4459,
    weight: 312,
    status: 'warning',
    capacity: 88,
    address: 'Khu K√Ω t√∫c x√° sinh vi√™n, ƒêH ƒê√† L·∫°t',
    contact: '0263.382.2246',
    hours: '6:00 - 22:00'
  },
  {
    id: 13,
    name: 'ƒêH ƒê√† L·∫°t - Th∆∞ vi·ªán trung t√¢m',
    lat: 11.9484,
    lng: 108.4419,
    weight: 98,
    status: 'active',
    capacity: 35,
    address: 'Th∆∞ vi·ªán Trung t√¢m, ƒêH ƒê√† L·∫°t',
    contact: '0263.382.2246',
    hours: '7:00 - 21:00'
  },
  {
    id: 14,
    name: 'ƒêH ƒê√† L·∫°t - Nh√† ƒÉn sinh vi√™n',
    lat: 11.9474,
    lng: 108.4469,
    weight: 445,
    status: 'warning',
    capacity: 92,
    address: 'Nh√† ƒÉn Sinh vi√™n, ƒêH ƒê√† L·∫°t',
    contact: '0263.382.2246',
    hours: '6:00 - 20:00'
  },
  {
    id: 15,
    name: 'ƒêH ƒê√† L·∫°t - S√¢n golf',
    lat: 11.9454,
    lng: 108.4409,
    weight: 134,
    status: 'active',
    capacity: 42,
    address: 'S√¢n golf 18 l·ªó, ƒêH ƒê√† L·∫°t',
    contact: '0263.382.2246',
    hours: '6:00 - 18:00'
  },
  {
    id: 16,
    name: 'ƒêH ƒê√† L·∫°t - C·ªïng ch√≠nh',
    lat: 11.9464,
    lng: 108.4449,
    weight: 167,
    status: 'active',
    capacity: 55,
    address: '01 Ph√π ƒê·ªïng Thi√™n V∆∞∆°ng, Ph∆∞·ªùng 8',
    contact: '0263.382.2246',
    hours: '24/7'
  },
  {
    id: 17,
    name: 'ƒêH ƒê√† L·∫°t - Khu th·ªÉ thao',
    lat: 11.9534,
    lng: 108.4439,
    weight: 201,
    status: 'active',
    capacity: 61,
    address: 'S√¢n th·ªÉ thao, ƒêH ƒê√† L·∫°t',
    contact: '0263.382.2246',
    hours: '6:00 - 20:00'
  },
  {
    id: 18,
    name: 'ƒêH ƒê√† L·∫°t - Ph√≤ng th√≠ nghi·ªám',
    lat: 11.9544,
    lng: 108.4419,
    weight: 89,
    status: 'active',
    capacity: 28,
    address: 'Khu Ph√≤ng th√≠ nghi·ªám, ƒêH ƒê√† L·∫°t',
    contact: '0263.382.2246',
    hours: '7:00 - 17:00'
  }
  
];

// Custom icon theo status
function getMarkerIcon(status) {
  const iconColors = {
    active: '#10B981',
    warning: '#F59E0B',
    inactive: '#9CA3AF'
  };
  
  const color = iconColors[status] || '#6B7280';
  
  return L.divIcon({
    html: `
      <div style="
        background: ${color};
        width: 32px;
        height: 32px;
        border-radius: 50% 50% 50% 0;
        transform: rotate(-45deg);
        border: 3px solid white;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        display: flex;
        align-items: center;
        justify-content: center;
      ">
        <i class="fas fa-recycle" style="
          color: white;
          font-size: 14px;
          transform: rotate(45deg);
        "></i>
      </div>
    `,
    className: 'custom-marker',
    iconSize: [32, 32],
    iconAnchor: [16, 32],
    popupAnchor: [0, -32]
  });
}

// Status text
function getStatusText(status) {
  const texts = {
    active: 'Ho·∫°t ƒë·ªông t·ªët',
    warning: 'G·∫ßn ƒë·∫ßy - C·∫ßn thu gom',
    inactive: 'T·∫°m ng·ª´ng ho·∫°t ƒë·ªông'
  };
  return texts[status] || 'Kh√¥ng x√°c ƒë·ªãnh';
}

// T·∫°o popup content
function createPopupContent(point) {
  return `
    <div class="custom-popup">
      <div class="popup-header">
        <h3>
          <i class="fas fa-location-dot"></i>
          ${point.name}
        </h3>
        <p><i class="fas fa-map-marker-alt"></i> ${point.address}</p>
      </div>
      <div class="popup-body">
        <div class="popup-stats">
          <div class="popup-stat-box">
            <strong>${point.weight} kg</strong>
            <span>ƒê√£ thu gom</span>
          </div>
          <div class="popup-stat-box">
            <strong>${point.capacity}%</strong>
            <span>Dung l∆∞·ª£ng</span>
          </div>
        </div>
        <div class="popup-status ${point.status}">
          <i class="fas fa-circle"></i>
          ${getStatusText(point.status)}
        </div>
        <div style="margin-top: 12px; font-size: 12px; color: #6B7280;">
          <div style="margin-bottom: 6px;">
            <i class="fas fa-phone"></i> ${point.contact}
          </div>
          <div>
            <i class="fas fa-clock"></i> ${point.hours}
          </div>
        </div>
      </div>
      <div class="popup-footer">
        <div class="popup-actions">
          <button class="popup-btn popup-btn-primary" onclick="viewPointDetails(${point.id})">
            <i class="fas fa-info-circle"></i> Chi ti·∫øt
          </button>
          <button class="popup-btn popup-btn-secondary" onclick="getDirections(${point.lat}, ${point.lng})">
            <i class="fas fa-directions"></i> Ch·ªâ ƒë∆∞·ªùng
          </button>
        </div>
      </div>
    </div>
  `;
}

// Kh·ªüi t·∫°o map
function initLeafletMap() {
  // T·∫°o map
  leafletMap = L.map('leafletMap').setView([11.9404, 108.4419], 14);
  
  // Th√™m tile layer (b·∫£n ƒë·ªì n·ªÅn)
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap contributors',
    maxZoom: 19
  }).addTo(leafletMap);
  
  // T·∫°o marker layer
  markersLayer = L.layerGroup().addTo(leafletMap);
  
  // Th√™m markers
  addMarkersToMap();
  
  // Setup filter controls
  setupFilterControls();
  
  // Update stats
  updateMapStats();
}

// Th√™m markers l√™n map
function addMarkersToMap() {
  allMarkers = [];
  markersLayer.clearLayers();
  
  collectionPoints.forEach(point => {
    const marker = L.marker([point.lat, point.lng], {
      icon: getMarkerIcon(point.status)
    });
    
    marker.bindPopup(createPopupContent(point), {
      maxWidth: 300,
      className: 'custom-leaflet-popup'
    });
    
    // Tooltip khi hover
    marker.bindTooltip(`
      <strong>${point.name}</strong><br>
      ${point.weight} kg thu gom<br>
      ${point.capacity}% dung l∆∞·ª£ng
    `, {
      direction: 'top',
      offset: [0, -30]
    });
    
    marker.addTo(markersLayer);
    allMarkers.push({ marker, point });
  });
}

// Filter controls
function setupFilterControls() {
  const checkboxes = document.querySelectorAll('.filter-checkbox input');
  
  checkboxes.forEach(checkbox => {
    checkbox.addEventListener('change', function() {
      filterMarkers();
    });
  });
}

function filterMarkers() {
  const activeFilters = [];
  document.querySelectorAll('.filter-checkbox input:checked').forEach(cb => {
    activeFilters.push(cb.dataset.status);
  });
  
  allMarkers.forEach(({ marker, point }) => {
    if (activeFilters.includes(point.status)) {
      marker.addTo(markersLayer);
    } else {
      markersLayer.removeLayer(marker);
    }
  });
  
  updateMapStats();
}

// Update statistics
function updateMapStats() {
  const stats = {
    active: 0,
    warning: 0,
    inactive: 0,
    totalWeight: 0
  };
  
  collectionPoints.forEach(point => {
    stats[point.status]++;
    stats.totalWeight += point.weight;
  });
  
  document.getElementById('statsActive').textContent = stats.active;
  document.getElementById('statsWarning').textContent = stats.warning;
  document.getElementById('statsInactive').textContent = stats.inactive;
  document.getElementById('statsTotal').textContent = stats.totalWeight.toLocaleString('vi-VN') + ' kg';
  
  document.getElementById('legendActive').textContent = stats.active;
  document.getElementById('legendWarning').textContent = stats.warning;
  document.getElementById('legendInactive').textContent = stats.inactive;
  document.getElementById('activePointsCount').textContent = stats.active + stats.warning;
}

// Map functions
function centerMap() {
  leafletMap.setView([11.9404, 108.4419], 14);
}

function refreshMapData() {
  addMarkersToMap();
  updateMapStats();
  alert('üîÑ ƒê√£ c·∫≠p nh·∫≠t d·ªØ li·ªáu!');
}

function toggleClustering() {
  alert('‚ö° T√≠nh nƒÉng gom c·ª•m s·∫Ω ƒë∆∞·ª£c th√™m trong b·∫£n c·∫≠p nh·∫≠t ti·∫øp theo!');
}

function viewPointDetails(pointId) {
  alert(`üìç Xem chi ti·∫øt ƒëi·ªÉm thu gom #${pointId}`);
  // Redirect ho·∫∑c m·ªü modal
}

function getDirections(lat, lng) {
  window.open(`https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`, '_blank');
}

// Initialize khi DOM ready
document.addEventListener('DOMContentLoaded', function() {
  initLeafletMap();
  
  // Counter animations (gi·ªØ nguy√™n code c≈©)
  const counters = document.querySelectorAll('.stat-number');
  counters.forEach(counter => {
    const target = parseInt(counter.getAttribute('data-target'));
    const duration = 2000;
    const increment = target / (duration / 16);
    let current = 0;
    
    const updateCounter = () => {
      current += increment;
      if (current < target) {
        counter.textContent = Math.floor(current).toLocaleString('vi-VN');
        requestAnimationFrame(updateCounter);
      } else {
        counter.textContent = target.toLocaleString('vi-VN');
      }
    };
    
    updateCounter();
  });
  
  console.log('‚úÖ Dashboard with Leaflet Map initialized!');
});
</script>
{% endblock %}
