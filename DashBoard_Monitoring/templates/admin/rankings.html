{% extends "admin/base.html" %}

{% block title %}B·∫£ng x·∫øp h·∫°ng{% endblock %}
{% block page_name %}B·∫£ng x·∫øp h·∫°ng{% endblock %}

{% block content %}

<!-- Ranking Filters -->
<div class="toolbar">
  <div class="filter-tabs">
    <button class="tab-btn active" data-period="weekly">
      <i class="fas fa-calendar-week"></i> Tu·∫ßn n√†y
    </button>
    <button class="tab-btn" data-period="monthly">
      <i class="fas fa-calendar-alt"></i> Th√°ng n√†y
    </button>
    <button class="tab-btn" data-period="alltime">
      <i class="fas fa-infinity"></i> T·∫•t c·∫£ th·ªùi gian
    </button>
  </div>
  
  <div class="toolbar-actions">
    <select class="filter-select">
      <option>T·∫•t c·∫£ ph∆∞·ªùng</option>
      <option>Ph∆∞·ªùng Xu√¢n H∆∞∆°ng</option>
      <option>Ph∆∞·ªùng Cam Ly</option>
      <option>Ph∆∞·ªùng L√¢m Vi√™n</option>
      <option>Ph∆∞·ªùng Xu√¢n Tr∆∞·ªùng</option>
      <option>Ph∆∞·ªùng Lang Biang</option>
    </select>
    
    <select class="filter-select">
      <option>X·∫øp theo ƒëi·ªÉm</option>
      <option>X·∫øp theo kg</option>
      <option>X·∫øp theo l∆∞·ª£t qu√©t</option>
    </select>
    
    <button class="btn btn-primary">
      <i class="fas fa-trophy"></i> Trao th∆∞·ªüng Top 10
    </button>
  </div>
</div>

<!-- ‚≠ê TOP 5 NG∆Ø·ªúI XU·∫§T S·∫ÆC ‚≠ê -->
<div class="podium-wrapper">
  <div class="podium-header">
    <h2><i class="fas fa-crown"></i> B·∫£ng Vinh Danh</h2>
    <p>Top 5 Chi·∫øn Binh Xanh Xu·∫•t S·∫Øc Nh·∫•t - Th√†nh Ph·ªë ƒê√† L·∫°t üáªüá≥</p>
  </div>

  <div class="podium-stage">
    <!-- 4th Place -->
    <div class="podium-player podium-rank-4" data-rank="4">
      <div class="player-content">
        <div class="rank-medal medal-4">
          <i class="fas fa-star"></i>
          <span class="rank-number">4</span>
        </div>
        <div class="player-avatar-wrap">
          <img src="{{ rankings[3].avatar }}" alt="{{ rankings[3].name }}" class="player-avatar">
          <div class="avatar-glow glow-4"></div>
        </div>
        <h3 class="player-name">{{ rankings[3].name }}</h3>
        <div class="player-location">
          <i class="fas fa-map-marker-alt"></i> {{ rankings[3].location }}
        </div>
        <div class="rank-title title-4">Ng√¥i Sao M·ªõi N·ªïi</div>
        <div class="player-stats">
          <div class="stat-point">
            <i class="fas fa-coins"></i>
            <strong>{{ rankings[3].points }}</strong>
          </div>
          <div class="stat-kg">
            <i class="fas fa-weight-hanging"></i>
            <strong>{{ rankings[3].total_kg }} kg</strong>
          </div>
        </div>
      </div>
      <div class="podium-base base-4">
        <div class="base-number">4</div>
      </div>
    </div>

    <!-- 2nd Place -->
    <div class="podium-player podium-rank-2" data-rank="2">
      <div class="player-content">
        <div class="rank-medal medal-2">
          <i class="fas fa-medal"></i>
          <span class="rank-number">2</span>
        </div>
        <div class="player-avatar-wrap">
          <img src="{{ rankings[1].avatar }}" alt="{{ rankings[1].name }}" class="player-avatar">
          <div class="avatar-glow glow-2"></div>
        </div>
        <h3 class="player-name">{{ rankings[1].name }}</h3>
        <div class="player-location">
          <i class="fas fa-map-marker-alt"></i> {{ rankings[1].location }}
        </div>
        <div class="rank-title title-2">√Å Qu√¢n Huy Ho√†ng</div>
        <div class="player-stats">
          <div class="stat-point">
            <i class="fas fa-coins"></i>
            <strong>{{ rankings[1].points }}</strong>
          </div>
          <div class="stat-kg">
            <i class="fas fa-weight-hanging"></i>
            <strong>{{ rankings[1].total_kg }} kg</strong>
          </div>
        </div>
      </div>
      <div class="podium-base base-2">
        <div class="base-number">2</div>
      </div>
    </div>

    <!-- 1st Place - CHAMPION -->
    <div class="podium-player podium-rank-1" data-rank="1">
      <div class="player-content">
        <div class="rank-medal medal-1">
          <i class="fas fa-crown"></i>
          <span class="rank-number">1</span>
        </div>
        <div class="player-avatar-wrap">
          <img src="{{ rankings[0].avatar }}" alt="{{ rankings[0].name }}" class="player-avatar">
          <div class="avatar-glow glow-1"></div>
        </div>
        <h3 class="player-name">{{ rankings[0].name }}</h3>
        <div class="player-location champion-location">
          <i class="fas fa-map-marker-alt"></i> {{ rankings[0].location }}
        </div>
        <div class="rank-title title-1">V√¥ ƒê·ªãch Tuy·ªát ƒê·ªëi</div>
        <div class="player-stats">
          <div class="stat-point">
            <i class="fas fa-coins"></i>
            <strong>{{ rankings[0].points }}</strong>
          </div>
          <div class="stat-kg">
            <i class="fas fa-weight-hanging"></i>
            <strong>{{ rankings[0].total_kg }} kg</strong>
          </div>
        </div>
      </div>
      <div class="podium-base base-1">
        <div class="base-number">1</div>
      </div>
    </div>

    <!-- 3rd Place -->
    <div class="podium-player podium-rank-3" data-rank="3">
      <div class="player-content">
        <div class="rank-medal medal-3">
          <i class="fas fa-medal"></i>
          <span class="rank-number">3</span>
        </div>
        <div class="player-avatar-wrap">
          <img src="{{ rankings[2].avatar }}" alt="{{ rankings[2].name }}" class="player-avatar">
          <div class="avatar-glow glow-3"></div>
        </div>
        <h3 class="player-name">{{ rankings[2].name }}</h3>
        <div class="player-location">
          <i class="fas fa-map-marker-alt"></i> {{ rankings[2].location }}
        </div>
        <div class="rank-title title-3">H·∫°ng Ba Ki√™n C∆∞·ªùng</div>
        <div class="player-stats">
          <div class="stat-point">
            <i class="fas fa-coins"></i>
            <strong>{{ rankings[2].points }}</strong>
          </div>
          <div class="stat-kg">
            <i class="fas fa-weight-hanging"></i>
            <strong>{{ rankings[2].total_kg }} kg</strong>
          </div>
        </div>
      </div>
      <div class="podium-base base-3">
        <div class="base-number">3</div>
      </div>
    </div>

    <!-- 5th Place -->
    <div class="podium-player podium-rank-5" data-rank="5">
      <div class="player-content">
        <div class="rank-medal medal-5">
          <i class="fas fa-star"></i>
          <span class="rank-number">5</span>
        </div>
        <div class="player-avatar-wrap">
          <img src="{{ rankings[4].avatar }}" alt="{{ rankings[4].name }}" class="player-avatar">
          <div class="avatar-glow glow-5"></div>
        </div>
        <h3 class="player-name">{{ rankings[4].name }}</h3>
        <div class="player-location">
          <i class="fas fa-map-marker-alt"></i> {{ rankings[4].location }}
        </div>
        <div class="rank-title title-5">Chi·∫øn Binh Ti·ªÅm NƒÉng</div>
        <div class="player-stats">
          <div class="stat-point">
            <i class="fas fa-coins"></i>
            <strong>{{ rankings[4].points }}</strong>
          </div>
          <div class="stat-kg">
            <i class="fas fa-weight-hanging"></i>
            <strong>{{ rankings[4].total_kg }} kg</strong>
          </div>
        </div>
      </div>
      <div class="podium-base base-5">
        <div class="base-number">5</div>
      </div>
    </div>
  </div>
</div>

<!-- ‚≠ê TOP PH∆Ø·ªúNG XU·∫§T S·∫ÆC ‚≠ê -->
<div class="areas-section">
  <div class="section-title">
    <h2><i class="fas fa-map-marked-alt"></i> Top Ph∆∞·ªùng Xu·∫•t S·∫Øc</h2>
    <p>Nh·ªØng khu v·ª±c d·∫´n ƒë·∫ßu trong phong tr√†o b·∫£o v·ªá m√¥i tr∆∞·ªùng t·∫°i ƒê√† L·∫°t</p>
  </div>

  <div class="areas-grid">
    {% for area in top_areas %}
    <div class="area-card rank-{{ loop.index }}">
      <div class="area-rank-badge">
        {% if loop.index == 1 %}
          <i class="fas fa-trophy"></i>
        {% elif loop.index == 2 %}
          <i class="fas fa-medal"></i>
        {% elif loop.index == 3 %}
          <i class="fas fa-award"></i>
        {% else %}
          <i class="fas fa-star"></i>
        {% endif %}
        <span>#{{ loop.index }}</span>
      </div>
      
      <div class="area-icon">
        <i class="fas fa-map-marker-alt"></i>
      </div>
      
      <h3 class="area-name">{{ area.name }}</h3>
      <div class="area-city">{{ area.city }}</div>
      
      <div class="area-stats-grid">
        <div class="area-stat">
          <i class="fas fa-weight-hanging"></i>
          <strong>{{ area.total_kg }} kg</strong>
          <span>T·ªïng kh·ªëi l∆∞·ª£ng</span>
        </div>
        <div class="area-stat">
          <i class="fas fa-users"></i>
          <strong>{{ area.members }}</strong>
          <span>Th√†nh vi√™n</span>
        </div>
        <div class="area-stat">
          <i class="fas fa-star"></i>
          <strong>{{ area.avg_points }}</strong>
          <span>ƒêi·ªÉm TB</span>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<!-- ‚≠ê TOP TR∆Ø·ªúNG H·ªåC XU·∫§T S·∫ÆC ‚≠ê -->
<div class="schools-section">
  <div class="section-title">
    <h2><i class="fas fa-school"></i> Top Tr∆∞·ªùng H·ªçc Xu·∫•t S·∫Øc</h2>
    <p>Nh·ªØng t·∫≠p th·ªÉ gi√°o d·ª•c ti√™n phong trong b·∫£o v·ªá m√¥i tr∆∞·ªùng t·∫°i ƒê√† L·∫°t</p>
  </div>

  <div class="schools-grid">
    {% for school in top_schools %}
    <div class="school-card rank-{{ loop.index }}">
      <div class="school-rank-badge">
        {% if loop.index == 1 %}
          <i class="fas fa-trophy"></i>
        {% elif loop.index == 2 %}
          <i class="fas fa-medal"></i>
        {% elif loop.index == 3 %}
          <i class="fas fa-award"></i>
        {% else %}
          <i class="fas fa-star"></i>
        {% endif %}
        <span>#{{ loop.index }}</span>
      </div>
      
      <div class="school-icon">
        <i class="fas fa-school"></i>
      </div>
      
      <h3 class="school-name">{{ school.name }}</h3>
      <div class="school-city">{{ school.city }}</div>
      
      <div class="school-stats-grid">
        <div class="school-stat">
          <i class="fas fa-weight-hanging"></i>
          <strong>{{ school.total_kg }} kg</strong>
          <span>T·ªïng kh·ªëi l∆∞·ª£ng</span>
        </div>
        <div class="school-stat">
          <i class="fas fa-users"></i>
          <strong>{{ school.members }}</strong>
          <span>Th√†nh vi√™n</span>
        </div>
        <div class="school-stat">
          <i class="fas fa-star"></i>
          <strong>{{ school.avg_points }}</strong>
          <span>ƒêi·ªÉm TB</span>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<!-- ‚≠ê B·∫¢NG CHI TI·∫æT NG∆Ø·ªúI D√ôNG ‚≠ê -->
<div class="data-table-card">
  <div class="card-header" style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
    <h3><i class="fas fa-list-ol"></i> B·∫£ng X·∫øp H·∫°ng Chi Ti·∫øt C√° Nh√¢n </h3>
    <div class="card-actions" style="margin-left: auto;">
      <button class="btn btn-sm btn-secondary">
        <i class="fas fa-download"></i> Xu·∫•t PDF
      </button>
    </div>
  </div>

  <table class="data-table ranking-table">
    <thead>
      <tr>
        <th>H·∫°ng</th>
        <th>Ng∆∞·ªùi d√πng</th>
        <th>Ph∆∞·ªùng/X√£</th>
        <th>Tr∆∞·ªùng/L·ªõp</th>
        <th>ƒêi·ªÉm</th>
        <th>T·ªïng kg</th>
        <th>L∆∞·ª£t qu√©t</th>
        <th>ƒê·ªô ch√≠nh x√°c</th>
        <th>Huy hi·ªáu</th>
        <th>Xu h∆∞·ªõng</th>
      </tr>
    </thead>
    <tbody>
      {% for user in rankings %}
      <tr>
        <td>
          <div class="rank-display">
            {% if loop.index <= 3 %}
              <i class="fas fa-trophy rank-{{ loop.index }}"></i>
            {% endif %}
            <strong>#{{ loop.index }}</strong>
          </div>
        </td>
        <td>
          <div class="user-cell">
            <img src="{{ user.avatar }}" alt="{{ user.name }}">
            <div>
              <strong>{{ user.name }}</strong>
              <span class="user-level">Level {{ user.level }}</span>
            </div>
          </div>
        </td>
        <td>
          <span class="location-badge">
            <i class="fas fa-map-marker-alt"></i> {{ user.location }}
          </span>
        </td>
        <td>
          <div class="school-info-cell">
            <strong>{{ user.school }}</strong>
            <span>{{ user.class_name }}</span>
          </div>
        </td>
        <td><strong class="text-primary">{{ user.points }}</strong></td>
        <td><strong class="text-success">{{ user.total_kg }} kg</strong></td>
        <td>{{ user.total_scans }}</td>
        <td>
          <div class="progress-bar">
            <div class="progress-fill" data-width="{{ user.accuracy }}" style="width: 0%;"></div>
          </div>
          <span class="progress-text">{{ user.accuracy }}%</span>
        </td>
        <td>
          <div class="badge-icons">
            {% for badge in user.badges[:3] %}
              <img src="{{ badge.icon }}" alt="{{ badge.name }}" title="{{ badge.name }}">
            {% endfor %}
            {% if user.badges|length > 3 %}
              <span class="badge-more">+{{ user.badges|length - 3 }}</span>
            {% endif %}
          </div>
        </td>
        <td>
          {% if user.rank_change > 0 %}
            <span class="trend trend-up">
              <i class="fas fa-arrow-up"></i> +{{ user.rank_change }}
            </span>
          {% elif user.rank_change < 0 %}
            <span class="trend trend-down">
              <i class="fas fa-arrow-down"></i> {{ user.rank_change }}
            </span>
          {% else %}
            <span class="trend trend-neutral">
              <i class="fas fa-minus"></i> 0
            </span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  
  <!-- Pagination -->
  <div class="pagination">
    <button class="btn-pagination">
      <i class="fas fa-chevron-left"></i>
    </button>
    <span>Trang 1 / 5</span>
    <button class="btn-pagination">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const progressBars = document.querySelectorAll('.progress-fill');
  progressBars.forEach(bar => {
    const targetWidth = bar.getAttribute('data-width');
    setTimeout(() => bar.style.width = targetWidth + '%', 100);
  });
  
  const podiumPlayers = document.querySelectorAll('.podium-player');
  podiumPlayers.forEach((player, index) => {
    player.style.animationDelay = `${index * 0.15}s`;
  });
  
  console.log('‚úÖ ƒê√† L·∫°t Rankings initialized!');
});
</script>
{% endblock %}
